<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>SocketIO Client</title>
    <script src="/socket.io/socket.io.js"></script>
    <link rel="stylesheet" href="ind.css">
  </head>
  
  <body style="background: #2C3E50;  /* fallback for old browsers */
  background: -webkit-linear-gradient(to right, #FD746C, #2C3E50);  /* Chrome 10-25, Safari 5.1-6 */
  background: linear-gradient(to right, #FD746C, #2C3E50); /* W3C, IE 10+/ Edge, Firefox 16+, Chrome 26+, Opera 12+, Safari 7+ */
  ">

    
     <div id="main1" style="display: none;  " >  
    <!-- <img src="" id="output"  width="100", height="150"> -->
    
    <div id="div1" style="border: 2px yellow solid;overflow: scroll; width: 500px;  margin-left: 450px; height: 550px; "  ></div>
    <!-- <div id="display"></div> -->
    
    <div id="boxe" style="margin-left: 450px; margin-top: 30px;">

   </div>
   <input type="file" id="input" style="display: none; margin-left: 450px;"  >
    </div>
    <!-- Client Code -->
    <script type="text/javascript">
      // Get WebSocket
      var socket = io();
      var room = "test";
      socket.emit("join", room);

      function setUsername() {
         socket.emit('setUsername', document.getElementById('name').value);
      };
      var user;
      socket.on('userExists', function(data) {
         document.getElementById('error-container').innerHTML = data;
      });
      socket.on('userSet', function(data) {
         document.body.style.backgroundColor= "#0cbaba";
         document.body.style.backgroundImage="linear-gradient(315deg, #0cbaba 0%, #380036 74%)";
        // document.getElementById('input').style.display="block";
         user = data.username;
         var x= document.getElementById('main');
         x.style.display= "none";
         document.getElementById('main1').style.display= "block";

         document.getElementById('boxe').innerHTML= '<input type = "text" id = "message" " >\
         <button type = "button" name = "button" onclick = "sendMessage()">Send</button><br><br>\
         <button id="btn2" onclick="karbe()">SEND IMAGE</button><br><br>';
         
      //    const input = document.getElementById("input");
      // input.style.display= "block";
      });
       function karbe(){
         var x= document.getElementById('input');
         x.style.display= "block";
       }      
      // const input = document.getElementById("input");
      // const output = document.getElementById("output");
     // var input = document.getElementById("input");
     // var output = document.getElementById("output");
//     function karbe(){
        document.getElementById("input").addEventListener("change", function (event) {
          
      // const output = document.getElementById("output");
      // output.style.display= "block";
        // Prepeare file reader
        var output= document.createElement('img');
        var file = event.target.files[0];
        var fileReader = new FileReader();
        fileReader.onloadend = function (event) {
          // Send an image event to the socket
          var image = event.target.result
          output.src = image;
          output.style.width="200";
          output.style.width="300";
          var out= document.createElement('div');
          out.appendChild(output);
          document.getElementById('div1').appendChild(out);
          document.getElementById('input').style.display= 'none';
          socket.emit("image", image);
        };
        // Read file
        fileReader.readAsDataURL(file);
      })
      
      //}
      socket.on("image", function (image) {
         var output= document.createElement('img');
         output.src= image;
         output.style.marginLeft="250px"
         output.style.width="200";
          output.style.width="300";
         var out= document.createElement('div');
          out.appendChild(output);
         document.getElementById('div1').appendChild(out);
      });
      function sendMessage() {
         var msg = document.getElementById('message').value;
         if(msg) {
            var para = document.createElement("p");
         var node = document.createTextNode(`${user} :: ${msg}`);
         para.style.color= "white";
         para.style.backgroundColor="brown";
         para.style.width="200px";
         para.style.height="20px";
         para.style.padding="10px";
         para.style.border="2px solid ";
         para.style.borderRadius="20px";
         para.style.verticalAlign="bottom";
         para.appendChild(node);
         var element = document.getElementById("div1");
         element.appendChild(para);      

            socket.emit('msg', {message: msg, user: user});
         }
      }
      socket.on('newmsg', function(data) {
       //  if(user) {
         var para = document.createElement("p");
         var node = document.createTextNode(`${data.user} :: ${data.message}`);
         para.style.color= "white";
         para.style.marginLeft="250px"
         para.style.backgroundColor="black";
         para.style.width="200px";
         para.style.height="20px";
         para.style.padding="10px";
         para.style.border="2px solid ";
         para.style.borderRadius="20px";
         para.style.verticalAlign="bottom";
         para.appendChild(node);
         var element = document.getElementById("div1");
         element.appendChild(para);      });
    </script>
    <div id="main" style="width: 500px;text-align: center;  height: 600px; border: 4px solid white; margin-left: 500px; border-radius: 25px; margin-top: 50px;">
    <h1 style="font-family: cursive ;" >WELCOME HERE <br> <br> LETS START CHAT  </h1>
      <div id = "error-container"></div>
    <input id = "name" type = "text" name = "name" value = "" 
       placeholder = "Enter your name!" style="margin-top: 100px; font-size: 20px; border-radius: 0.5px; width: 400px; height: 40px;" >
       <br><br>
    <button type = "button" id="btn1" style="padding: 10px; font-size: 15px; border-radius: 2px; margin-top: 40px;" name = "button" onclick = "setUsername()  ">
       Let me chat!
    </button>
    </div>
  </body>
</html>